"use strict";(self.webpackChunkedc_widgets_sfdc=self.webpackChunkedc_widgets_sfdc||[]).push([[236,973],{2513:(e,l,a)=>{a.r(l),a.d(l,{default:()=>h});var d=a(1649),o=a(2143),t=a(3442),n=a(9467),i=a(2856),u=a(5490),s=a(8984),r=a(5201),c=a(7546),v=a(4019),C=a(744),f=a(5338),p=a(8879),T=a(2414),_=a(8411),E=a(7064),L=a(7777),A=a(8170);const h=()=>{var e,l,a,h;const m=(0,t.s0)(),y=(0,r.p)(),{slug:k,type:I,pathway:O,id:P}=(0,t.UO)(),{userInfo:g,orgInfo:x,ldFlags:S}=(0,d.useContext)(s.Il),[R,D]=(0,d.useState)(),[b,N]=(0,d.useState)(),[w,H]=(0,d.useState)(),M="0"===O,j=(0,f.Th)(I,k),{data:Y={},isLoading:U}=(0,c.Z)((()=>(0,C.x)({url:j}))),{data:V,isLoading:B}=(0,c.Z)((()=>(0,C.x)({url:(0,f.N0)({journeyId:Y.id,pathwayId:O,all:!0})})),{enabled:!!Y&&!U&&!M}),G=(0,d.useMemo)((()=>{var e;return V?null===V||void 0===V?void 0:V.totalCount:null===Y||void 0===Y||null===(e=Y.packCards)||void 0===e?void 0:e.length}),[V,null===Y||void 0===Y||null===(e=Y.packCards)||void 0===e?void 0:e.length]),Q=(0,d.useCallback)((()=>{D((e=>e-1<0?e:e-1))}),[]),Z=(0,d.useMemo)((()=>(0,p.f)(null===Y||void 0===Y?void 0:Y.filestack[0].url,"height:200",null===Y||void 0===Y?void 0:Y.filestack[0].mimetype,null===Y||void 0===Y?void 0:Y.filestack[0].handle,g.filestackApp,g.jwtToken,!0)),[null===Y||void 0===Y?void 0:Y.filestack,g.filestackApp,g.jwtToken]),W=(0,d.useMemo)((()=>(0,_.c3)(x)),[x]),F=null===W||void 0===W||null===(l=W.web)||void 0===l||null===(a=l.pathways[i.default.ORG_LABEL_CONFIG.PATHWAY_COMPLETION_CONFIG])||void 0===a?void 0:a.defaultValue,J=(0,d.useCallback)((async()=>{if(F===i.default.PATHWAY_COMPLETION_LABEL.DISABLE_NEXT)return;const e=null===b||void 0===b?void 0:b[R];if(e){const d=null===Y||void 0===Y?void 0:Y.autoComplete;if(F===i.default.PATHWAY_COMPLETION_LABEL.CREATOR_NOT_CHOOSE||F===i.default.PATHWAY_COMPLETION_LABEL.CREATOR_CHOOSE&&d){const d={use_mark_as_complete_v2:!0,completion_language:null===e||void 0===e?void 0:e.language,state:i.default.COMPLETE,context_id:null===Y||void 0===Y?void 0:Y.externalId,context_type:M?i.default.LOWER_CASE_PATHWAY:i.default.CARD_SUBTYPE.JOURNEY},[,o]=await(0,v.fN)({cardId:null===e||void 0===e?void 0:e.id,payload:d});var l,a;if(o)y.open((null===o||void 0===o||null===(l=o.data)||void 0===l?void 0:l.message)||i.default.ERRORS.MESSAGE);else null!==(a=b[R+1])&&void 0!==a&&a.isLocked&&N((e=>{const l=[...e];l[R].completionState=i.default.COMPLETED;const a=l[R+1];return a&&(a.isLocked=!1),l}))}}}),[b,R,M,null===Y||void 0===Y?void 0:Y.autoComplete,null===Y||void 0===Y?void 0:Y.externalId,F,y]),X=(0,d.useMemo)((()=>{var e;return!(!R||!b.length||(null===(e=b[R])||void 0===e?void 0:e.message)!==i.default.ERROR_MESSAGES.NOT_AUTHORIZED_TO_ACCESS_CARD)}),[b,R]),q=(0,d.useCallback)((e=>e===i.default.COMPLETED),[]),z=(0,d.useCallback)((function(){let{index:e,cards:l=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e&&!l.length)return!1;let a=0;return l.slice(0,e).forEach((e=>{e.completionState!==i.default.COMPLETED&&e.cardType!==i.default.CARD_TYPE.POLL||a++})),a===e}),[]),K=(0,d.useMemo)((()=>{if(R&&b.length){var e,l;const a=(null===(e=b[R])||void 0===e?void 0:e.locked)||(null===(l=b[R])||void 0===l?void 0:l.isLocked);return(!a||!z({index:R,cards:b}))&&a}return!1}),[b,R,z]),$=(0,d.useCallback)((async()=>{var e,l,a,d,o,t,n,u,s;const r=b[R];let c=(null===r||void 0===r||null===(e=r.completionState)||void 0===e?void 0:e.toUpperCase())===i.default.COMPLETED||(null===r||void 0===r||null===(l=r.completionState)||void 0===l?void 0:l.toUpperCase())===i.default.INITIALIZED;const v=null===Y||void 0===Y?void 0:Y.autoComplete;let C=r&&!r.isLocked;const p=null===(a=(null===r||void 0===r?void 0:r.cardType)||(null===r||void 0===r?void 0:r.content_type))||void 0===a?void 0:a.toLowerCase();let _=!!(null===S||void 0===S||!S["show-markAsComplete-on-visit"])&&(null===r||void 0===r?void 0:r.resource)&&(r.resource.url||r.resource.description||r.resource.fileUrl)&&r.resource.type!==i.default.CONTENT_TYPE&&((null===r||void 0===r||null===(d=r.readableCardType)||void 0===d?void 0:d.toUpperCase())===i.default.CARD_SUBTYPE.ARTICLE.toUpperCase()||(null===(o=[i.default.CARD_SUBTYPE.ARTICLE,i.default.insight])||void 0===o?void 0:o.includes(p)));const E=p===i.default.CARD_TYPE.PROJECT&&(0,T.hf)((0,f._E)({authorId:null===r||void 0===r||null===(t=r.author)||void 0===t?void 0:t.id,userId:(0,f.n5)(g)})),L=p===i.default.CARD_TYPE.TRAINING&&(null===r||void 0===r?void 0:r.cardSubtype)===i.default.CARD_SUBTYPE.VILT||p===i.default.CARD_SUBTYPE.VILT,A=(null===r||void 0===r||null===(n=r.trainingDetails)||void 0===n||null===(u=n.registrations)||void 0===u?void 0:u.state)===i.default.APPROVED,h=null===r||void 0===r||null===(s=r.trainingDetails)||void 0===s?void 0:s.endDate;X||c||!v||!r||[i.default.CARD_TYPE.POLL,i.default.CARD_TYPE.QUIZ].includes(r.cardType)||!C||_||E||(L&&h&&A||!L)&&await J(),G!==R+1?D((e=>e+1===G?e:e+1)):m("".concat(i.default.PAGES.CARD_DETAILS,"/").concat(I,"/").concat(k))}),[b,R,null===Y||void 0===Y?void 0:Y.autoComplete,S,g,X,G,J,m,I,k]),ee=(0,d.useMemo)((()=>{if(O){var e;const l=null===Y||void 0===Y||null===(e=Y.journeySection)||void 0===e?void 0:e.find((e=>e.card_id===O));return null===l||void 0===l?void 0:l.block_title}}),[null===Y||void 0===Y?void 0:Y.journeySection,O]);return(0,d.useEffect)((()=>{const e=M?null===Y||void 0===Y?void 0:Y.packCards:null===V||void 0===V?void 0:V.cards;N(e),H(e),D((null===e||void 0===e?void 0:e.findIndex((e=>e.id===P)))||0)}),[P,null===V||void 0===V?void 0:V.cards,M,null===Y||void 0===Y?void 0:Y.packCards]),(0,A.jsxs)("div",{className:"edc-pathway-card-view",children:[(0,A.jsx)("div",{className:"edc-my-1 edc-back-section",children:(0,A.jsx)(n.Z,{})}),U||B?"":(0,A.jsx)(o.JourneyPathwayDetailViewHeaderSlider,{data:{type:null===Y||void 0===Y?void 0:Y.readableCardType,title:M?"".concat(null===b||void 0===b?void 0:b.length," ").concat((0,E.HQ)({key:"smartCardTextLabel",defaultTranslatedValue:u.p.Channels.smart_cards})):ee,body:(0,A.jsx)("div",{dangerouslySetInnerHTML:{__html:null===Y||void 0===Y?void 0:Y.title}}),image:Z},toHomeText:M?(0,A.jsx)(A.Fragment,{children:(0,E.HQ)({key:"Channels_toPathwayHome",defaultTranslatedValue:u.p.Channels.to_pathway_home})}):(0,A.jsx)(A.Fragment,{children:(0,E.HQ)({key:"Channels_toJourneyHome",defaultTranslatedValue:u.p.Channels.to_journey_home})}),onNextCard:$,onPreviousCard:Q,currentIndex:R,total:G,className:"edc-mx-1 edc-my-1",onToHomeClick:()=>{m("".concat(i.default.PAGES.CARD_DETAILS,"/").concat(I,"/").concat(k))},allowNextOnLast:!0,previousCardLabel:(0,E.HQ)({key:"Channels_previousCardLabel",defaultTranslatedValue:u.p.Channels.previous_card_label}),nextCardLabel:(0,E.HQ)({key:"Channels_nextCardLabel",defaultTranslatedValue:u.p.Channels.next_card_label}),cardLabelText:(0,E.HQ)({key:"Channels_cardLabelText",defaultTranslatedValue:u.p.Channels.card_label_text})}),b&&Array.isArray(b)&&null!==b&&void 0!==b&&b.length&&R>=0?(0,A.jsx)("div",{className:X?"":"edc-paper",children:(0,A.jsx)(L.default,{cardId:null===(h=b[R])||void 0===h?void 0:h.id,contextId:Y&&(null===Y||void 0===Y?void 0:Y.externalId),contextType:M?"pathway":"journey",isPrivateCard:X,isLockedCard:K,toggleCardLock:e=>{N((l=>{var a,d;const o=l.findIndex((l=>l.id===e)),t=o>=0&&z({index:o,cards:l}),n=Object.assign(l),u=l[o];u.completionState=q(u.completionState)?i.default.INITIALIZED:i.default.COMPLETED;const s=n[o+1],r=u.cardType===i.default.CARD_TYPE.POLL||q(u.completionState);return s&&(null!==(a=w[o+1])&&void 0!==a&&a.isLocked||null!==(d=w[o+1])&&void 0!==d&&d.locked)&&(s.isLocked=!(t&&r)),n}))}})}):(0,A.jsx)(o.Spinner,{variant:"lg",spinnerMessage:(0,E.HQ)({key:"loadingMoreData",defaultTranslatedValue:u.p.Channels.loading})})]})}}}]);